generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String        @id @default(cuid())
  email           String        @unique
  name            String?
  password        String?
  role            Role          @default(USER)
  image           String?
  contactNumber   String?
  reputation      Int           @default(0)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  commentEdits    CommentEdit[]
  comments        Comment[]
  reportsReceived UserReport[]  @relation("reportsReceived")
  reportsMade     UserReport[]  @relation("reportsMade")

  @@map("users")
}

model News {
  id             Int       @id @default(autoincrement())
  title          String
  categoryId     String
  author         String
  published_date String?
  image          String?
  imageUrl       String?
  summary        String?
  content        String
  tags           String[]
  status         String    @default("published")
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  comments       Comment[]
  category       Category  @relation("NewsCategory", fields: [categoryId], references: [id])

  @@map("news")
}

model Comment {
  id          Int           @id @default(autoincrement())
  userId      String
  newsId      Int
  content     String
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  editHistory CommentEdit[]
  news        News          @relation(fields: [newsId], references: [id])
  user        User          @relation(fields: [userId], references: [id])
  reports     UserReport[]

  @@map("comments")
}

model CommentEdit {
  id         String   @id @default(cuid())
  commentId  Int
  oldContent String
  newContent String
  reason     String?
  createdAt  DateTime @default(now())
  userId     String
  comment    Comment  @relation(fields: [commentId], references: [id])
  user       User     @relation(fields: [userId], references: [id])

  @@map("comment_edits")
}

model AnalyticsEvent {
  id        String   @id @default(cuid())
  type      String
  sessionId String
  userId    String?
  path      String
  userAgent String?
  referrer  String?
  timestamp DateTime @default(now())
  metadata  Json?

  @@index([type])
  @@index([sessionId])
  @@index([path])
  @@index([timestamp])
}

model UserReport {
  id             String   @id @default(cuid())
  reporterId     String
  reportedUserId String
  commentId      Int?
  reason         String
  status         String   @default("pending")
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  comment        Comment? @relation(fields: [commentId], references: [id])
  reportedUser   User     @relation("reportsReceived", fields: [reportedUserId], references: [id])
  reporter       User     @relation("reportsMade", fields: [reporterId], references: [id])

  @@index([reportedUserId])
  @@index([reporterId])
  @@index([status])
  @@map("user_reports")
}

model SiteSettings {
  id                String   @id @default(cuid())
  siteName          String   @default("News Portal")
  siteDescription   String   @default("Your trusted source for news")
  siteLogo          String?
  siteFavicon       String?
  siteUrl           String   @default("http://localhost:3000")
  metaTitle         String   @default("News Portal - Latest News")
  metaDescription   String   @default("Stay updated with the latest news")
  metaKeywords      String   @default("news, portal, latest, updates")
  ogImage           String?
  twitterCard       String?
  contactEmail      String?
  contactPhone      String?
  contactAddress    String?
  facebookUrl       String?
  twitterUrl        String?
  instagramUrl      String?
  linkedinUrl       String?
  youtubeUrl        String?
  googleAnalyticsId String?
  facebookPixelId   String?
  footerText        String   @default("Â© 2024 News Portal. All rights reserved.")
  footerLinks       Json?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@map("site_settings")
}

model PageContent {
  id              String   @id @default(cuid())
  pageSlug        String   @unique
  pageTitle       String
  pageContent     String
  metaTitle       String?
  metaDescription String?
  metaKeywords    String?
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("page_content")
}

model MediaFile {
  id           String   @id @default(cuid())
  fileName     String
  originalName String
  filePath     String
  fileSize     Int
  mimeType     String
  uploadedBy   String
  createdAt    DateTime @default(now())

  @@map("media_files")
}

model Category {
  id            String     @id @default(cuid())
  name          String
  slug          String     @unique
  description   String?
  parentId      String?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  parent        Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  subcategories Category[] @relation("CategoryHierarchy")
  articles      News[]     @relation("NewsCategory")

  @@map("categories")
}

model ContactMessage {
  id        String   @id @default(cuid())
  name      String
  email     String
  message   String
  resolved  Boolean  @default(false)
  createdAt DateTime @default(now())

  @@map("contact_messages")
}

model JobApplication {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String?
  position  String
  coverNote String?
  cvPath    String
  createdAt DateTime @default(now())

  @@map("job_applications")
}

enum Role {
  USER
  EDITOR
  ADMIN
}
